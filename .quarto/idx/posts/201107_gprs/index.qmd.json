{"title":"Using the Nokia 6510 GSM modem over IrDA","markdown":{"yaml":{"title":"Using the Nokia 6510 GSM modem over IrDA","author":"Jona JOACHIM","date":"2011-02-07","categories":["unix"]},"containsRefs":false,"markdown":"\n\nSo it looks like everybody has a smartphone nowadays, however I still\nuse my Nokia 6510 on a daily basis.\nLike many phones back then, it has an IrDA (Infrared Data Association)\ninterface which permits communication with the phone and I felt like\nplaying with it a bit.\nFor this I used a laptop with integrated IrDA interface, the OpenBSD\noperating system and the ppp tool that ships with it, the birda\npackage and the smstools package.\nThe ircomm tool that ships with birda lets you initiate an IrDA COMM\nconnection with the phone and lets you attach a pseudo terminal to it:\n\n```bash\nircomm -d /dev/tty01 -y /dev/ptypz\n```\n\nHere, /dev/tty01 is the actual IrDA interface that ircomm talks to and\n/dev/ptypz is a pseudo terminal it allocates that lets you talk to the\nGSM modem inside the device. The modem understands AT style commands.\nActually you don't talk directy to the modem but rather to some\nrestricted modem emulation.\n\nFor more information see:\n\n- <http://en.wikipedia.org/wiki/Hayes_command_set#GSM>\n- <http://wiki.openmoko.org/wiki/Hardware:AT_Commands>\n- <http://wiki.openmoko.org/wiki/Manually_using_GSM>\n- <http://wiki.openmoko.org/wiki/Manually_using_GPRS>\n\nI use the ppp(8) tool to talk to the modem but anything else will work.\nHere's a first session:\n\n```bash\nspaceman% sudo ppp\nPassword:\nWorking in interactive mode\nUsing interface: tun0\nWarning: No default entry found in config file.\nppp ON spaceman> set device /dev/ttypz\nppp ON spaceman> term\ndeflink: Entering terminal mode on /dev/ttypz\nType `~?' for help\nATE1\nOK\n\nRING\n\nRING\nATA\nOK\nATH\nOK\nATD0952880000;\nOK\n\nNO CARRIER\nAT\nOK\n\nppp ON spaceman>\n```\n\nSome explanations: \"ATE1\" enables echoing, which enables you to see what\nyou type, this is not required. The phone responds with \"OK\" when it\ncorrectly processes a command.\nI then call the phone and the modem shows that a call is incoming with\nthe \"RING\" signal. You can then accept the call with \"ATA\" or reject it\nwith \"ATH\". I accepted the call, talked a bit and then hung up using\n\"ATH\".\nThen I called my home phone from the mobile phone using the ATD command.\n'D' here stands for dialling and the command dials the number that\nfollows the command. I then hung up from the home phone which the modem\nsignals with \"NO CARRIER\".\n\nHere's another session where I try to establish a GPRS connection for\ntethering. This unfortunately doesn't work, I don't really know why,\nprobably the provider forbids it:\n\n```default\nppp ON spaceman> term\nAT+CGDCONT=1,\"IP\",\"gprs-service-fr.net\"\nOK\nATD*99#\nCONNECT\nppp ON spaceman> Warning: Sending empty PAP authname!\nPpp ON spaceman>\nPPp ON spaceman> Warning: ff01:8::: Change route failed: errno: Network is unreachable\nWarning: ff02:8::: Change route failed: errno: Network is unreachable\nWarning: ff02:8::: Change route failed: errno: Network is unreachable\nppp ON spaceman>\n```\n\nSo here I first set the APN which is needed for GPRS, using the CGDCONT\ncommand, the value depends on your provider. Then I dial the special\nnumber *99#. The modem tries to establish the connection, which it\nsignals with \"CONNECT\". It then starts talking PPP (Point-to-Point\nProtocol). The ppp(8) tool detects the fact that PPP is now spoken and\ntakes over to establish a PPP link, which unfortunately fails here. The\nnumber of capital 'P's on the prompt show the state of the connection:\n\n```default\nppp ON awfulhak>               # No link has been established\nPpp ON awfulhak>               # We've connected & finished LCP\nPPp ON awfulhak>               # We've authenticated\nPPP ON awfulhak>               # We've agreed IP numbers\n```\n\nSo, as you can see here, authentication is successful but we don't get\nan IP address. When it fails, the phone beeps and shows the following\nerror: \"Subscribe to GPRS first\".\n\nOne final thing I wanted to play with is SMS. Writing SMSes manually\nusing AT style commands is cumbersome, so I used the smstools package\nwhich comes with a daemon that does the dirty work of talking to the\nmodem. I set it up to talk to the /dev/ptypz device. Once it runs you\ncan send SMSes using the \"sendsms\" command line tool, for example:\n\n```bash\nspaceman% sendsms 33668360000 'Test Message'\n```\n\nMy phone number actually starts in \"0668\". \"33\" is the international\nprefix of my country (France), so you get how you have to format the\nnumber.\n\nHere is the log of the smsd daemon for this command:\n\n```default\n2011-02-07 17:06:58,5, smsd: Moved file /var/spool/sms/outgoing/send_qzxMhS to /var/spool/sms/checked\n2011-02-07 17:06:58,6, GSM1: I have to send 1 short message for /var/spool/sms/checked/send_qzxMhS\n2011-02-07 17:06:58,6, GSM1: Sending SMS from  to 33668360000\n2011-02-07 17:06:58,6, GSM1: Checking if modem is ready\n2011-02-07 17:06:59,7, GSM1: -> AT\n2011-02-07 17:06:59,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:06:59,7, GSM1: <- OK\n2011-02-07 17:06:59,6, GSM1: Pre-initializing modem\n2011-02-07 17:06:59,7, GSM1: -> ATE0+CMEE=1;+CREG=2\n2011-02-07 17:07:00,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:00,7, GSM1: <- OK\n2011-02-07 17:07:01,7, GSM1: -> AT+CSQ\n2011-02-07 17:07:01,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:01,7, GSM1: <- +CSQ: 20,99 OK\n2011-02-07 17:07:01,6, GSM1: Signal Strength Indicator: (20,99) -73 dBm (Excellent), Bit Error Rate: not known or not detectable\n2011-02-07 17:07:01,6, GSM1: Checking if Modem is registered to the network\n2011-02-07 17:07:01,7, GSM1: -> AT+CREG?\n2011-02-07 17:07:02,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:02,7, GSM1: <- +CREG: 2,1,\"00D6\",\"9C99\" OK\n2011-02-07 17:07:02,6, GSM1: Modem is registered to the network\n2011-02-07 17:07:02,6, GSM1: Selecting PDU mode\n2011-02-07 17:07:02,7, GSM1: -> AT+CMGF=0\n2011-02-07 17:07:03,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:03,7, GSM1: <- OK\n2011-02-07 17:07:03,7, GSM1: -> AT+CMGS=18\n2011-02-07 17:07:04,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:04,7, GSM1: <- >\n2011-02-07 17:07:04,7, GSM1: -> 0011000B913366388639F90000FF04F4F29C0E\n2011-02-07 17:07:06,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:10,7, GSM1: <- +CMGS: 214 OK\n2011-02-07 17:07:10,5, GSM1: SMS sent, Message_id: 214, To: 33668360000, sending time 12 sec.\n2011-02-07 17:07:10,6, GSM1: Deleted file /var/spool/sms/checked/send_qzxMhS\n```\n\nThe message got delivered correctly.\nsmsd is also able to receive incoming SMS, however I haven't tried it\nand I'm not sure it works since the modem of this phone does not signal\nanything when it receives a message.\n\nThe birda package also includes some tools to use OBEX over IrDA. This\nlets you send and receive vCards with contacts (what Nokia calls\n\"Business Cards\").\nFor example, to send a vCard with a contact named \"John\" and phone\nnumber 06... to your phone you can use the following command:\n\n```bash\nmkobextel -n John -t 0668360001 |  irobex -d /dev/tty01\n```\n\nReceiving vCards sent from the phone also works.\n\nHave fun!\n\nUpdate:\nI just add this here for the nostalgia\n\n```default\nAT+CGMI\nNokia Mobile Phones\n\nOK\nAT+CGMM\nNokia 6510\n\nOK\nAT+CGMR\nV 04.12\n28-08-02\nNPM-9\n(c) NMP.\n\nOK\n```","srcMarkdownNoYaml":"\n\nSo it looks like everybody has a smartphone nowadays, however I still\nuse my Nokia 6510 on a daily basis.\nLike many phones back then, it has an IrDA (Infrared Data Association)\ninterface which permits communication with the phone and I felt like\nplaying with it a bit.\nFor this I used a laptop with integrated IrDA interface, the OpenBSD\noperating system and the ppp tool that ships with it, the birda\npackage and the smstools package.\nThe ircomm tool that ships with birda lets you initiate an IrDA COMM\nconnection with the phone and lets you attach a pseudo terminal to it:\n\n```bash\nircomm -d /dev/tty01 -y /dev/ptypz\n```\n\nHere, /dev/tty01 is the actual IrDA interface that ircomm talks to and\n/dev/ptypz is a pseudo terminal it allocates that lets you talk to the\nGSM modem inside the device. The modem understands AT style commands.\nActually you don't talk directy to the modem but rather to some\nrestricted modem emulation.\n\nFor more information see:\n\n- <http://en.wikipedia.org/wiki/Hayes_command_set#GSM>\n- <http://wiki.openmoko.org/wiki/Hardware:AT_Commands>\n- <http://wiki.openmoko.org/wiki/Manually_using_GSM>\n- <http://wiki.openmoko.org/wiki/Manually_using_GPRS>\n\nI use the ppp(8) tool to talk to the modem but anything else will work.\nHere's a first session:\n\n```bash\nspaceman% sudo ppp\nPassword:\nWorking in interactive mode\nUsing interface: tun0\nWarning: No default entry found in config file.\nppp ON spaceman> set device /dev/ttypz\nppp ON spaceman> term\ndeflink: Entering terminal mode on /dev/ttypz\nType `~?' for help\nATE1\nOK\n\nRING\n\nRING\nATA\nOK\nATH\nOK\nATD0952880000;\nOK\n\nNO CARRIER\nAT\nOK\n\nppp ON spaceman>\n```\n\nSome explanations: \"ATE1\" enables echoing, which enables you to see what\nyou type, this is not required. The phone responds with \"OK\" when it\ncorrectly processes a command.\nI then call the phone and the modem shows that a call is incoming with\nthe \"RING\" signal. You can then accept the call with \"ATA\" or reject it\nwith \"ATH\". I accepted the call, talked a bit and then hung up using\n\"ATH\".\nThen I called my home phone from the mobile phone using the ATD command.\n'D' here stands for dialling and the command dials the number that\nfollows the command. I then hung up from the home phone which the modem\nsignals with \"NO CARRIER\".\n\nHere's another session where I try to establish a GPRS connection for\ntethering. This unfortunately doesn't work, I don't really know why,\nprobably the provider forbids it:\n\n```default\nppp ON spaceman> term\nAT+CGDCONT=1,\"IP\",\"gprs-service-fr.net\"\nOK\nATD*99#\nCONNECT\nppp ON spaceman> Warning: Sending empty PAP authname!\nPpp ON spaceman>\nPPp ON spaceman> Warning: ff01:8::: Change route failed: errno: Network is unreachable\nWarning: ff02:8::: Change route failed: errno: Network is unreachable\nWarning: ff02:8::: Change route failed: errno: Network is unreachable\nppp ON spaceman>\n```\n\nSo here I first set the APN which is needed for GPRS, using the CGDCONT\ncommand, the value depends on your provider. Then I dial the special\nnumber *99#. The modem tries to establish the connection, which it\nsignals with \"CONNECT\". It then starts talking PPP (Point-to-Point\nProtocol). The ppp(8) tool detects the fact that PPP is now spoken and\ntakes over to establish a PPP link, which unfortunately fails here. The\nnumber of capital 'P's on the prompt show the state of the connection:\n\n```default\nppp ON awfulhak>               # No link has been established\nPpp ON awfulhak>               # We've connected & finished LCP\nPPp ON awfulhak>               # We've authenticated\nPPP ON awfulhak>               # We've agreed IP numbers\n```\n\nSo, as you can see here, authentication is successful but we don't get\nan IP address. When it fails, the phone beeps and shows the following\nerror: \"Subscribe to GPRS first\".\n\nOne final thing I wanted to play with is SMS. Writing SMSes manually\nusing AT style commands is cumbersome, so I used the smstools package\nwhich comes with a daemon that does the dirty work of talking to the\nmodem. I set it up to talk to the /dev/ptypz device. Once it runs you\ncan send SMSes using the \"sendsms\" command line tool, for example:\n\n```bash\nspaceman% sendsms 33668360000 'Test Message'\n```\n\nMy phone number actually starts in \"0668\". \"33\" is the international\nprefix of my country (France), so you get how you have to format the\nnumber.\n\nHere is the log of the smsd daemon for this command:\n\n```default\n2011-02-07 17:06:58,5, smsd: Moved file /var/spool/sms/outgoing/send_qzxMhS to /var/spool/sms/checked\n2011-02-07 17:06:58,6, GSM1: I have to send 1 short message for /var/spool/sms/checked/send_qzxMhS\n2011-02-07 17:06:58,6, GSM1: Sending SMS from  to 33668360000\n2011-02-07 17:06:58,6, GSM1: Checking if modem is ready\n2011-02-07 17:06:59,7, GSM1: -> AT\n2011-02-07 17:06:59,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:06:59,7, GSM1: <- OK\n2011-02-07 17:06:59,6, GSM1: Pre-initializing modem\n2011-02-07 17:06:59,7, GSM1: -> ATE0+CMEE=1;+CREG=2\n2011-02-07 17:07:00,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:00,7, GSM1: <- OK\n2011-02-07 17:07:01,7, GSM1: -> AT+CSQ\n2011-02-07 17:07:01,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:01,7, GSM1: <- +CSQ: 20,99 OK\n2011-02-07 17:07:01,6, GSM1: Signal Strength Indicator: (20,99) -73 dBm (Excellent), Bit Error Rate: not known or not detectable\n2011-02-07 17:07:01,6, GSM1: Checking if Modem is registered to the network\n2011-02-07 17:07:01,7, GSM1: -> AT+CREG?\n2011-02-07 17:07:02,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:02,7, GSM1: <- +CREG: 2,1,\"00D6\",\"9C99\" OK\n2011-02-07 17:07:02,6, GSM1: Modem is registered to the network\n2011-02-07 17:07:02,6, GSM1: Selecting PDU mode\n2011-02-07 17:07:02,7, GSM1: -> AT+CMGF=0\n2011-02-07 17:07:03,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:03,7, GSM1: <- OK\n2011-02-07 17:07:03,7, GSM1: -> AT+CMGS=18\n2011-02-07 17:07:04,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:04,7, GSM1: <- >\n2011-02-07 17:07:04,7, GSM1: -> 0011000B913366388639F90000FF04F4F29C0E\n2011-02-07 17:07:06,7, GSM1: Command is sent, waiting for the answer\n2011-02-07 17:07:10,7, GSM1: <- +CMGS: 214 OK\n2011-02-07 17:07:10,5, GSM1: SMS sent, Message_id: 214, To: 33668360000, sending time 12 sec.\n2011-02-07 17:07:10,6, GSM1: Deleted file /var/spool/sms/checked/send_qzxMhS\n```\n\nThe message got delivered correctly.\nsmsd is also able to receive incoming SMS, however I haven't tried it\nand I'm not sure it works since the modem of this phone does not signal\nanything when it receives a message.\n\nThe birda package also includes some tools to use OBEX over IrDA. This\nlets you send and receive vCards with contacts (what Nokia calls\n\"Business Cards\").\nFor example, to send a vCard with a contact named \"John\" and phone\nnumber 06... to your phone you can use the following command:\n\n```bash\nmkobextel -n John -t 0668360001 |  irobex -d /dev/tty01\n```\n\nReceiving vCards sent from the phone also works.\n\nHave fun!\n\nUpdate:\nI just add this here for the nostalgia\n\n```default\nAT+CGMI\nNokia Mobile Phones\n\nOK\nAT+CGMM\nNokia 6510\n\nOK\nAT+CGMR\nV 04.12\n28-08-02\nNPM-9\n(c) NMP.\n\nOK\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.33","theme":{"light":"flatly","dark":"slate"},"title-block-banner":true,"title":"Using the Nokia 6510 GSM modem over IrDA","author":"Jona JOACHIM","date":"2011-02-07","categories":["unix"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}